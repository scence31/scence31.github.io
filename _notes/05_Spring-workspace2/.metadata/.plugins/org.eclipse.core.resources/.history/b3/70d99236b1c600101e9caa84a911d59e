package com.kh.spring.member.model.service;

import java.util.ArrayList;

import org.mybatis.spring.SqlSessionTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.kh.spring.member.model.dao.MemberDao;
import com.kh.spring.member.model.vo.Member;

/*
 * * Service 단의 흐름 - 트랜잭션 한개의 단위
 * 
 * 1. SqlSession 객체 생성
 * 2. SqlSession 객체와 전달값을 넘기면서 DAO 호출 후 결과 받기
 * 3. DML 문의 경우 결과에 따른 트랜잭션 처리 하기
 * 4. SqlSession 객체 반납
 * 5. 결과를 Controller 로 리턴
 * 
 * > 스프링에서는 IoC, DI 라는 특징에 의해 내가 직접 객체 생성할 필요 X
 *    								 내가 직접 객체를 반납할 필요 X
 *   (SqlSession 객체를 내가 직접 생성, 반납할 필요가 없음!!) 
 * > 스프링에서는 IoC 특징에 의해 내가 직접 트랜잭션 처리를 할 필요 X
 *   (스프링이 알아서 자동으로 트랜잭션 처리를 해줄 것임!!)   
 * > 스프링에서는 순수 마이바티스 때 쓰던 SqlSession 객체 대신
 *   스프링용 개조 버전인 객체인 SqlSessionTemplate 객체를 쓸 예정임!!
 *    
 * 1. SqlSessionTemplate 객체와 전달값을 넘기면서 DAO 호출 후 결과 받기
 * 2. 결과를 Controller 로 리턴
 * 
 * > 스프링이 주도권을 쥐기 때문에 코드가 간결해진다!!
 *   즉, 내부적으로 스프링이 알아서 코드를 실행시켜 주겠다!!
 */

// 필요할 때 마다 이 클래스를 가지고 객체 생성좀 해줘 라고 알려주는 것
// > "빈 등록" 이라고 부른다!! @Component 라는 어노테이션 이용 가능!!
// @Component
@Service
// > @Service 어노테이션 또한 @Component 어노테이션과 같은 역할임!!
//   더 명시적이기 때문에 더 자주 쓰인다!!
public class MemberService {
	
	@Autowired
	private SqlSessionTemplate sqlSession;
	// > SqlSessionTemplate : SqlSession 의 스프링용 개조 버전
	//						  이미 빈으로 등록되어있기 때문에 받아 쓰면 됨!!
	
	// MemberDao 도 공통적으로 필요한 객체이므로 전역변수로 빼 둘 것!!
	@Autowired
	private MemberDao memberDao;
	
	// 로그인 요청에 대한 트랜잭션 처리용 메소드
	public Member loginMember(Member m) {
		
		return memberDao.loginMember(sqlSession, m);
	}
	
	// 회원가입 요청에 대한 트랜잭션 처리용 메소드
	@Transactional
	// > 이 메소드를 하나의 트랜잭션 단위로 관리하겠다.
	//   이 메소드 실행 중 dml 문 처리 시 Exception 이 발생하면
	//   자동으로 롤백 해주는 효과를 준다!!
	public int insertMember(Member m) {
		
		return memberDao.insertMember(sqlSession, m);
	}
	
	// 회원 정보 수정 요청에 대한 트랜잭션 처리용 메소드
	@Transactional
	public int updateMember(Member m) {
		
		return memberDao.updateMember(sqlSession, m);
	}

	// 비밀번호 변경 요청에 대한 트랜잭션 처리용 메소드
	@Transactional
	public int updatePwd(Member m) {
		
		return memberDao.updatePwd(sqlSession, m);
	}
	
	// 회원 탈퇴 요청에 대한 트랜잭션 처리용 메소드
	@Transactional
	public int deleteMember(String userId) {
		
		return memberDao.deleteMember(sqlSession, userId);
	}
	
	// 회원아이디 중복확인용 트랜잭션 처리 메소드
	public int ajaxIdCheck(String checkId) {
		
		return memberDao.ajaxIdCheck(sqlSession, checkId);
	}
	
	//
	public ArrayList<Member> selectMemberList() {
		
		return memberDao.selectMemberList(sqlSession);
	}
	
}





