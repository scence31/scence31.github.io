<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">

	<resultMap id="boardResultSet" type="board" >
	<id column="BOARD_NO" property="boardNo" />
	<result column="BOARD_TITLE" property="boardTitle" />
	<result column="BOARD_WRITER" property="boardWriter" />
	<result column="ORIGIN_NAME" property="originName" />
	<result column="COUNT" property="count" />
	<result column="CREATE_DATE" property="createDate" />
	
	<result column="BOARD_CONTENT" property="boardContent" />
	<result column="CHANGE_NAME" property="changeName" />
	
	</resultMap>

	<!-- 게시글 총 개수 쿼리문 -->
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*)
		  FROM BOARD
		 WHERE STATUS = 'Y'
	</select>
	
	<!-- 게시글 목록조회 쿼리문 -->
	<select id="selectBoardList" resultMap="boardResultSet">
		SELECT *
		  FROM (
                SELECT ROWNUM AS RNUM, A.*
                  FROM (
                         SELECT BOARD_NO, BOARD_TITLE, BOARD_WRITER, ORIGIN_NAME, COUNT, CREATE_DATE
                           FROM BOARD
                          WHERE STATUS = 'Y'
                          ORDER BY BOARD_NO DESC
                  ) A
                  WHERE ROWNUM &lt;= #{endRow}
		)
		WHERE RNUM &gt;= #{startRow}
	</select>
	
	<!-- 게시글 검색개수 카운트하기 -->
	<select id="selectSearchCount" parameterType="string" resultType="_int">
		SELECT COUNT(*)
		  FROM BOARD
		 WHERE BOARD_TITLE LIKE '%' || #{keyword} || '%'
		   AND STATUS = 'Y'
	</select>
	
	<!-- 게시글 검색용 쿼리문 -->
	<select id="selectSearchList" resultMap="boardResultSet">
		SELECT *
		  FROM (
                SELECT ROWNUM AS RNUM, A.*
                  FROM (
                         SELECT BOARD_NO, BOARD_TITLE, BOARD_WRITER, ORIGIN_NAME, COUNT, CREATE_DATE
                           FROM BOARD
                          WHERE STATUS = 'Y'
                            AND BOARD_TITLE LIKE '%' || #{keyword} || '%'
                          ORDER BY BOARD_NO DESC
                  ) A
                  WHERE ROWNUM &lt;= #{endRow}
		)
		WHERE RNUM &gt;= #{startRow}		
	</select>
	
	<insert id="insertBoard" parameterType="board">
		INSERT INTO BOARD(BOARD_NO, BOARD_TITLE, BOARD_WRITER, BOARD_CONTENT, ORIGIN_NAME, CHANGE_NAME)
                    VALUES(SEQ_BNO.NEXTVAL, #{boardTitle}, #{boardWriter}, #{boardContent}, #{originName}, #{changeName})
	</insert>
	
	<!-- 조회수 -->
	<update id="increaseCount" parameterType="_int">
		UPDATE BOARD
		   SET COUNT = COUNT + 1
		 WHERE BOARD_NO = #{boardNo}
		   AND STATUS = 'Y'
	</update>
	
	<!-- 상세조회 -->
	<select id="selectBoard" parameterType="_int" resultMap="boardResultSet">
		SELECT BOARD_NO, BOARD_TITLE, BOARD_WRITER, BOARD_CONTENT, ORIGIN_NAME, CHANGE_NAME, CREATE_DATE
		  FROM BOARD
		 WHERE BOARD_NO = #{boardNo}
		   AND STATUS= 'Y'
	</select>
	
	<!-- 원번파일명 조회 -->
	<select id="selectOriginFileName" parameterType="string" resultType="string">
		SELECT ORIGIN_NAME
		  FROM BOARD
		 WHERE CHANGE_NAME = #{changeName}
		   AND STATUS = 'Y'
	</select>
	
	<update id="updateBoard" parameterType="board">
		UPDATE BOARD
		   SET BOARD_TITLE = #{boardTitle}, BOARD_CONTENT = #{boardContent}, ORIGIN_NAME = #{originName}, CHANGE_NAME = #{changeName}
		 WHERE BOARD_NO = #{boardNo}
		   AND STATUS = 'Y'
	</update>
	
	<!-- 게시글 삭제 -->
	<update id="deleteBoard" parameterType="_int">
		UPDATE BOARD
		   SET STATUS = 'N'
		 WHERE BOARD_NO = #{boardNo}
		   AND STATUS = 'Y'
	</update>
</mapper>





























